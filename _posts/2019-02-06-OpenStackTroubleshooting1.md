---
layout: post
title: OpenStack Troubleshooting 1 
category: OpenStack
tags: [OpenStack]
---

#1, local storage 
Hypervisor show compute node disk storage under / by default, how to add other disk partition   
  
per comment in nova.conf, There is an instances_path specifying the storage for instances. 
```
# This directory is used to store Nova's internal state. It is used by a
# variety of other config options which derive from this. In some scenarios
# (for example migrations) it makes sense to use a storage location which is
# shared between multiple compute hosts (for example via NFS). Unless the
# option ``instances_path`` gets overwritten, this directory can grow very
# large.
#
# Possible values:
#
# * The full path to a directory. Defaults to value provided in ``pybasedir``.
#  (string value)
#state_path=/var/lib/nova
```

move local storage from / to /home by updating instances_path
```
mkdir -p /home/nova/instances
chown nova.nova /home/nova/instances
instances_path=/home/nova/instances
```

restart nova service on compute node  
```
systemctl restart openstack-nova-compute.service
```

#2, add controller node as a compute node 
```
# install package
yum install openstack-nova-compute
# start compute service 
systemctl enable  openstack-nova-compute.service
systemctl start  openstack-nova-compute.service
systemctl status  openstack-nova-compute.service
# discover node 
su -s /bin/sh -c "nova-manage cell_v2 discover_hosts --verbose" nova
# verification 
[root@controller nova]# openstack compute service list --service nova-compute
+----+--------------+----------------------------+------+---------+-------+----------------------------+
| ID | Binary       | Host                       | Zone | Status  | State | Updated At                 |
+----+--------------+----------------------------+------+---------+-------+----------------------------+
| 19 | nova-compute | compute    | nova | enabled | up    | 2019-02-15T19:11:57.000000 |
| 20 | nova-compute | controller | nova | enabled | up    | 2019-02-15T19:11:58.000000 |
+----+--------------+----------------------------+------+---------+-------+----------------------------+
```

#3, launch an instance 
create a self-service (private) network that connects to the physical network infrastructure via NAT. This network includes a DHCP server that provides IP addresses to instances. An instance on this network can automatically access external networks such as the Internet. However, access to an instance on this network from external networks such as the Internet requires a floating IP address.
```
#create a selfservice network 
[root@kos2000 nova]# openstack network list
[root@kos2000 nova]# openstack network create selfservice
openstack subnet create --network selfservice \
  --dns-nameserver DNS_RESOLVER --gateway SELFSERVICE_NETWORK_GATEWAY \
  --subnet-range SELFSERVICE_NETWORK_CIDR selfservice
  
Replace DNS_RESOLVER with the IP address of a DNS resolver. In most cases, you can use one from the /etc/resolv.conf file on the host.
Replace SELFSERVICE_NETWORK_GATEWAY with the gateway you want to use on the self-service network, typically the “.1” IP address.
Replace SELFSERVICE_NETWORK_CIDR with the subnet you want to use on the self-service network. You can use any arbitrary value, although we recommend a network from RFC 1918.
[root@kos2000 nova]# cat /etc/resolv.conf
# Generated by NetworkManager
search bridgewatersys.com
nameserver 192.168.150.93

openstack subnet create --network selfservice \
  --dns-nameserver 192.168.150.93 --gateway 172.16.1.1 \
  --subnet-range 172.16.1.0/24 selfservice 
  
# create a router:  Self-service networks connect to provider networks using a virtual router that typically performs bidirectional NAT.   
  Each router contains an interface on at least one self-service network and a gateway on a provider network.
The provider network must include the router:external option to enable self-service routers to use it for connectivity to external networks such as the Internet. The admin or other privileged user must include this option during network creation or add it later. In this case, the router:external option was set by using the --external parameter when creating the provider network.
openstack router create router
openstack router add subnet router selfservice
openstack router set router --external-gateway <public network>

  
```

#4, when using openvswitch as ml2 plugin, got "Failed to bind port" when creating instance 
```
server.log:2019-02-15 18:05:47.648 4703 ERROR neutron.plugins.ml2.managers [req-af35ee67-42b0-42c6-adfa-5aa3a69adef2 d1ff116fb58b4248b7751ff565f3b59d ea9720993f374495a74c7d5c865b65a4 - default default] 
Failed to bind port 501fa0f2-9155-4e57-a434-51f3f9e21c61 on host compute for vnic_type normal 
using segments [{'network_id': 'a02cbdff-8198-4627-80d0-7768b98b5c0f', 'segmentation_id': None, 'physical_network': u'extnet', 'id': '8242fc76-79be-4281-b635-dc18f1e82e86', 'network_type': u'flat'}]
```








