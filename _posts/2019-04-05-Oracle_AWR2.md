---
layout: post
title: Oracle - AWR report shows load unbalabce
category: Oracle
tags: [Oracle]
---

We have a 8-way streams replication, 8 servers handling traffic from a bunch of RADIUS servers. There is 1 node, let's call it DB1, got CPU warning.   

Check CPU history on Solaris  
```
sar -u -f /var/adm/sa/sa16  
```

Compare DB1 & DB2, AWR report shows heavier load on DB1.   
Top 2 SQL by Gets shows "Gets per Exec" is similar, while Executions is 320K vs. 110K, user calls is 2584 vs. 680.   
List the RADIUS servers each DB supports, suggest that re-distributing workload is an option to decrease CPU on DB1.   

Customer replied with 2 questions:   
+ There is no change made in the network so why would the load change in DB1 now and it did not complain before?  
   If you run sar -u -f /var/adm/sa/saxx for this month, you will see CPU idle percentage on node1 has been 20~ 30% for a while, before that it’s around 40%, it’s not a sudden change.    
+ What role does F5 load balancer have as far as distributing load   
   The F5 is a load balancer. It balances load based on connections.   
   The connections from a PDSN therefore are typically hitting one Radius server and the traffic per PDSN is not the same for each PDSN,therefore, traffic to each DB will be unbalanced as you are indicating.  

Next, count transactions per RADIUS server , to prove the load un-balance, and how would re-distribulation balance the load. 
```
cat logfile.timestamp | egrep "auth" | cut -b1-10 | uniq -c   # line started with Apr 16 05:10:01 , "cut -b1-10" means count per hour, "cut -b1-12" means count per minute 
114713 Apr 16 05:
124815 Apr 16 06:
119857 Apr 16 07:
```
Next, count transactions per PDSN, find which PDSN with the top request 

reference:    
+ F5 load balancer   
https://www.f5.com/services/resources/glossary/load-balancer  
+ RADIUS   
Remote Authentication Dial-In User Service (RADIUS) is a client/server protocol and software that enables remote access servers to communicate with a central server to authenticate dial-in users and authorize their access to the requested system or service.  
https://www.cisco.com/c/en/us/support/docs/security-vpn/remote-authentication-dial-user-service-radius/12433-32.html  
